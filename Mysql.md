# Mysql笔记（《MySQL技术内幕， InnoDb存储引擎》）

## 第一章 MySQL体系结构和储存引擎

### 1.1 定义数据库和实例

* 数据库：物理操作系统文件或其他形式文件类型的集合
  * 文件可能是frm、MYD、MYI、ibd结尾的文件
  * 使用NDB引擎是，数据库的文件可能不是操作系统上的文件，而是存放于内存中的文件
* 实例：MySQL数据库由后台线程以及一个
  * 共享的内存可以被运行的后台线程共享
  * 数据库实例才是真正操作数据库文件的

在MySQL中实例和数据库一般是一一对应的，即一个实例对应一个数据库，一个数据库对应一个实例。但是在集群情况下可能存在一个数据库被多个数据实例使用的情况。

MySQL是一个单进程多线程的数据库，MySQL数据库实例在系统上表现就是一个进程。

当启动实例的时候，MySQL会去读取配置文件，根据配置文件的参数来启动数据库实例。如果没有配置文件，会按照编译时的默认参数启动实例。用`mysql --help | grep my.cnf`可以查看从哪里查询配置文件

![linux mysql 配置文件](https://dxytoll-img-1304942391.cos.ap-nanjing.myqcloud.com/img/image-20211209215551773.png)

![windows mysql 配置文件](https://dxytoll-img-1304942391.cos.ap-nanjing.myqcloud.com/img/image-20211209220500113.png)

如果有多个配置文件，并且都包含相同的配置，会以最后一个出现的文件中的参数为准

配置参数中有一个datadir，该参数指定了数据库所在路径。`show variables like 'datadir';`

![datadir](C:%5CUsers%5CDXY%5CDesktop%5Cnote%5Cimg%5Cimage-20211209222311943.png)

### MySQL体系结构

* 数据库：文件的集合，是依照某种数据模型组织起来并存放于二级储存器中的数据集合
* 数据库实例：是程序，是位于用户和操作系统之间的一层数据管理软件

大白话：数据库是文件，用于储存数据，crud操作通过数据库实例（software）去实现

![MySQL体系架构](https://dxytoll-img-1304942391.cos.ap-nanjing.myqcloud.com/img/20190218162644838.jpg)

上图是mysql官方文档中的图片，有以下几个部分

| 名称               | 作用                                                         |
| :----------------- | :----------------------------------------------------------- |
| 连接池组件         | 由于每次建立建立需要消耗很多时间，连接池的作用就是将这些连接缓存下来，下次可以直接用已经建立好的连接，提升服务器性能。 |
| 管理服务和工具组件 | 系统管理和控制工具，例如备份恢复、Mysql复制、集群等          |
| SQL接口组件        | 接受用户的SQL命令，并且返回用户需要查询的结果。比如select from就是调用SQL Interface |
| 查询分析器组件     | SQL命令传递到解析器的时候会被解析器验证和解析。解析器是由Lex和YACC实现的，是一个很长的脚本， 主要功能：<br/>1. 将SQL语句分解成数据结构，并将这个结构传递到后续步骤，以后SQL语句的传递和处理就是基于这个结构的<br/>2. 如果在分解构成中遇到错误，那么就说明这个sql语句是不合理的 |
| 优化器组件         | 查询优化器，SQL语句在查询之前会使用查询优化器对查询进行优化。他使用的是“选取-投影-联接”策略进行查询。 |
| 缓冲（Cache）组件  | 查询缓存，如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。<br/>通过LRU算法将数据的冷端溢出，未来得及时刷新到磁盘的数据页，叫脏页。 |
| 插件式储存引擎     | 存储引擎。存储引擎是MySql中具体的与文件打交道的子系统。也是Mysql最具有特色的一个地方。 <br/>Mysql的存储引擎是插件式的。它根据MySql AB公司提供的文件访问层的一个抽象接口来定制一种文件访问机制（这种访问机制就叫存储引擎） |
| 物理文件           |                                                              |

插件式的存储引擎架构提供了一系列标准管理和服务支持，这些与存储引擎本身无关。存储引擎是底层物理机构的实现，每个储存引擎开发者可以按照自己的意愿开发。

> 公司的new sql就是